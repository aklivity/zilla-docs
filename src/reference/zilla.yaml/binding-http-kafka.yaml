http_kafka_proxy0:
  type: http-kafka
  kind: proxy
  routes:
    - when:
        - method: GET
          path: "/items"
      exit: kafka_cache_client0
      with:
        capability: fetch
        topic: items-snapshots
        merge:
          content-type: application/json
    - when:
        - method: GET
          path: "/items/{id}"
      exit: kafka_cache_client0
      with:
        capability: fetch
        topic: items-snapshots
        filters:
          - key: "${params.id}"
    - when:
        - path: "/items/{id}" #?
        - method: GET
          path: "/items/{id};{correlationId}"
      exit: kafka_cache_client0
      with:
        capability: produce
        topic: items-requests
        acks: leader_only
        key: "${params.id}"
        reply-to: items-responses
        async:
          location: "/items/${params.id};${correlationId}"
